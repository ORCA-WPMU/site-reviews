"use strict";var x=jQuery.noConflict(),GLSR={addons:{},pinned:{},shortcode:{}};GLSR.colorControls=function(){"object"==typeof x.wp&&"function"==typeof x.wp.wpColorPicker&&x(document).find('input[type="text"].color-picker-hex').each(function(){var e=x(this),t=e.data("colorpicker")||{};e.wpColorPicker(t)})},GLSR.dismissNotices=function(){x(".notice.is-dismissible").each(function(){var e=x(this);e.fadeTo(100,0,function(){e.slideUp(100,function(){e.remove()})})})},GLSR.getURLParameter=function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null},GLSR.insertNotices=function(e){e=e||!1,e&&(x("#glsr-notices").length||(x("#message.notice").remove(),x("form#post").before('<div id="glsr-notices" />')),x("#glsr-notices").html(e),x(document).trigger("wp-updates-notice-added"))},GLSR.normalizeValue=function(e){return["true","on","1"].indexOf(e)>-1||!(["false","off","0"].indexOf(e)>-1)&&e},GLSR.normalizeValues=function(e){return e.map(GLSR.normalizeValue)},GLSR.onClearLog=function(e){e.preventDefault();var t=x(this);if(!t.is(":disabled")){var n={action:site_reviews.action,request:{action:"clear-log"}};t.prop("disabled",!0),x.post(site_reviews.ajaxurl,n,function(e){GLSR.insertNotices(e.notices),x("#log-file").val(e.log),t.prop("disabled",!1)},"json")}},GLSR.onFieldChange=function(){var e=x(this).closest("form").find("[data-depends]");if(e.length)for(var t=this.getAttribute("name"),n=this.getAttribute("type"),o=0;o<e.length;o++)try{var i,s=JSON.parse(e[o].getAttribute("data-depends"));if(s.name!==t)continue;i="checkbox"===n?!!this.checked:x.isArray(s.value)?x.inArray(GLSR.normalizeValue(this.value),GLSR.normalizeValues(s.value))!==-1:GLSR.normalizeValue(s.value)===GLSR.normalizeValue(this.value),GLSR.toggleHiddenField(e[o],i)}catch(r){}},GLSR.pointers=function(e){x(e.target).pointer({content:e.options.content,position:e.options.position,close:function(){x.post(ajaxurl,{pointer:e.id,action:"dismiss-wp-pointer"})}}).pointer("open").pointer("sendToTop"),x(document).on("wp-window-resized",function(){x(e.target).pointer("reposition")})},GLSR.textareaResize=function(e){var t=320,n=e[0];n.style.height="auto",n.style.height=n.scrollHeight>t?n.scrollHeight+"px":t+"px"},GLSR.toggleHiddenField=function(e,t){var n=x(e).closest(".glsr-field");n.length&&(t?n.removeClass("hidden"):n.addClass("hidden"))},GLSR.pinned.events=function(){var e=x("#pinned-status-select");x("a.cancel-pinned-status").on("click",function(t){t.preventDefault(),e.slideUp("fast").siblings("a.edit-pinned-status").show().focus(),e.find("select").val("0"===x("#hidden-pinned-status").val()?1:0)}),x("a.edit-pinned-status").on("click",function(t){t.preventDefault(),e.is(":hidden")&&(e.slideDown("fast",function(){e.find("select").focus()}),x(this).hide())}),x("a.save-pinned-status").on("click",function(t){t.preventDefault(),e.slideUp("fast").siblings("a.edit-pinned-status").show().focus(),GLSR.pinned.save(x(this))}),x("table").on("click","td.sticky i",GLSR.pinned.onToggle)},GLSR.pinned.onToggle=function(){var e=x(this),t={action:site_reviews.action,request:{action:"toggle-pinned",id:e[0].getAttribute("data-id")}};x.post(site_reviews.ajaxurl,t,function(t){t.pinned?e.addClass("pinned"):e.removeClass("pinned")})},GLSR.pinned.save=function(e){var t={action:site_reviews.action,request:{action:"toggle-pinned",id:x("#post_ID").val(),pinned:x("#pinned-status").val()}};x.post(site_reviews.ajaxurl,t,function(t){x("#pinned-status").val(0|!t.pinned),x("#hidden-pinned-status").val(0|t.pinned),x("#pinned-status-text").text(t.pinned?e.data("yes"):e.data("no")),GLSR.insertNotices(t.notices)})},GLSR.shortcode.close=function(e){var t=x(e=e||".glsr-mce-button");t.length&&t.removeClass("active").parent().find(".glsr-mce-menu").hide()},GLSR.shortcode.open=function(e){x(e).addClass("active").parent().find(".glsr-mce-menu").show()},GLSR.shortcode.toggle=function(e){e.preventDefault(),x(this).hasClass("active")?GLSR.shortcode.close(this):GLSR.shortcode.open(this)},GLSR.shortcode.trigger=function(e){e.preventDefault(),GLSR.shortcode.current=x(this).attr("data-shortcode"),GLSR.shortcode.current&&(tinymce.get(window.wpActiveEditor)?tinymce.execCommand("GLSR_Shortcode"):(x("#scTemp").length||(x("body").append('<textarea id="scTemp" style="display: none;" />'),tinymce.init({mode:"exact",elements:"scTemp",plugins:["glsr_shortcode","wplink"]})),setTimeout(function(){tinymce.execCommand("GLSR_Shortcode")},200)),setTimeout(function(){GLSR.shortcode.close()},100))},GLSR.shortcode.create=function(e){var t=tinymce.get(e);if(t){var n={action:site_reviews.action,request:{action:"mce-shortcode",shortcode:GLSR.shortcode.current}};x.post(site_reviews.ajaxurl,n,function(e){if(e.body){if(0===e.body.length)return window.send_to_editor("["+e.shortcode+"]"),void GLSR.shortcode.destroy();var n=[{text:e.ok,classes:"primary glsr-mce-primary",onclick:function(){var e,n,o,i;i=t.windowManager.getWindows()[0],n=site_reviews.shortcodes[GLSR.shortcode.current],o=!0;for(var s in n)if(n.hasOwnProperty(s)&&(e=i.find("#"+s)[0],"undefined"!=typeof e&&""===e.state.data.value)){o=!1,alert(n[s]);break}o&&i.submit()}},{text:e.close,onclick:"close"}],o={title:e.title,body:e.body,classes:"glsr-mce-popup",minWidth:320,buttons:n,onsubmit:function(t){var n="",o=GLSR.shortcode.normalize(t.data);for(var i in o)o.hasOwnProperty(i)&&""!==o[i]&&(n+=" "+i+'="'+o[i]+'"');window.send_to_editor("["+e.shortcode+n+"]")},onclose:function(){GLSR.shortcode.destroy()}};e.ok.constructor===Array&&(o.buttons[0].text=e.ok[0],o.buttons[0].onclick="close",delete o.buttons[1]),t.windowManager.open(o)}})}},GLSR.shortcode.normalize=function(e){var t={site_reviews:["author","date","excerpt","rating","title","url"],site_reviews_form:["email","name","review","terms","title"]},n=[];for(var o in e){if(t.hasOwnProperty(GLSR.shortcode.current)){var i="";0===o.lastIndexOf("hide_",0)&&(i=o.substring(5)),t[GLSR.shortcode.current].indexOf(i)>-1&&(e[o]&&n.push(i),delete e[o])}"count"!==o||x.isNumeric(e[o])||(e[o]=""),"id"===o&&(e[o]=(+new Date).toString(36))}return e.hide=n.join(","),e},GLSR.shortcode.destroy=function(){var e=x("#scTemp");e.length&&(tinymce.get("scTemp").remove(),e.remove())},x(function(){var e=GLSR.getURLParameter("fix"),t=x("#contentdiv > textarea");e&&x('td [data-key="'+e+'"]').focus(),t.length&&(GLSR.textareaResize(t),x(document).on("wp-window-resized.editor-expand",function(){GLSR.textareaResize(t)})),x("form").on("change",":input",GLSR.onFieldChange),x("form").on("click","#clear-log",GLSR.onClearLog),GLSR.colorControls(),GLSR.pinned.events(),x.each(site_reviews_pointers.pointers,function(e,t){GLSR.pointers(t)}),x(document).on("click",function(e){x(e.target).closest(".glsr-mce").length||GLSR.shortcode.close()}),x(document).on("click",".glsr-mce-button",GLSR.shortcode.toggle),x(document).on("click",".glsr-mce-menu-item",GLSR.shortcode.trigger),x(document).on("click",".branch-4 .toggle-row, .branch-4-1 .toggle-row, .branch-4-2 .toggle-row",function(){x(this).closest("tr").toggleClass("is-expanded")})});